# üåü ClassSight: Smart Auto Attendance System

A solution to streamline and automate student attendance logging using a **Two-Factor Computer Vision** approach: **Face Recognition** and **Object Tracking with Handoff**.

-----

## üèÜ FLC Hackloop Project Submission

| Detail | Value |
| :--- | :--- |
| **Event** | FLC Hackloop |
| **Team Name** | **Code Mavericks** |

### Team Members

| Name | USN |
| :--- | :--- |
| **P Devdat** | NNM24IS145 |
| **M K Subrahmanya** | NNM24CS128 |
| **Pratham R** | NNM24IS168 |
| **Suyash** | NNM24IS148 |

-----

## ‚ú® Concept

ClassSight addresses the limitations of traditional single-camera attendance systems (e.g., poor lighting, occluded faces) by combining two cameras in a sequential workflow:

1.  **High-Confidence Face Recognition (Cam 1):** Quickly identifies students at a choke point (e.g., doorway).
2.  **Seamless Handoff & Tracking (Cam 2):** Immediately tags the identified person in a wider-view tracker, confirming their presence and location within the room.

This ensures **high accuracy** and **reduces redundancy** while maintaining a smooth and fast process for the students.

-----

## üöÄ Key Features

  * **Dual-Camera Architecture:** Utilizes Camera 1 for primary face verification and Camera 2 for continuous tracking and secondary verification.
  * **ArcFace Face Recognition:** Uses the **ArcFace** model with **DeepFace** for high-accuracy face embedding generation and verification.
  * **YOLOv8 & ByteTrack:** Uses **YOLOv8** for real-time person detection and **ByteTrack** for persistent object tracking in Camera 2.
  * **Intelligent Attendance Logging:** Attendance is logged against the correct **course/class** by checking the real-time schedule against a `timetable` table in the database.
  * **MySQL Integration:** Stores student, timetable, and attendance records securely using a MySQL backend with connection pooling for efficiency.
  * **Async Body Recognition Fallback:** Camera 2 attempts to identify "Unknown" tracked persons by analyzing body crops via an asynchronous API call.

-----

## üèóÔ∏è Architecture Breakdown

The project is structured into three main phases:

### Phase 1: Data Preparation

1.  **Image Download (`photos.py`):** Fetches multiple-pose (frontal, left, right, up, down) image URLs for all students from the `enrollments` MySQL table and saves them to the `enrollment_images/` directory.
2.  **Face Enrollment (`enroll.py`):** Iterates through the downloaded images, extracts a 512-dimension faceprint using the **DeepFace ArcFace** model, and compiles the faceprints into `face_database.json`.

### Phase 2: Live Identification & Handoff (Camera 1)

  * **Frontend (`cam1UI.py`):** A **Streamlit** interface that uses OpenCV and Haar Cascades for live face detection. It captures a frame only after a face has been stable for **2 seconds**.
  * **Backend (`main.py`):** A **FastAPI** server that receives the base64 image from the UI. It performs **ArcFace verification** against the `face_database.json`. On successful match, it:
      * Logs the attendance in MySQL.
      * Sends a real-time **handoff** containing the USN to the Camera 2 API.

### Phase 3: Continuous Tracking & Verification (Camera 2)

  * **Tracker (`camera_2_tracker.py`):** Uses **YOLOv8** and **ByteTrack** to maintain a persistent ID for every person visible in the wider field of view.
  * **Handoff Integration:** Upon receiving the handoff from Cam 1, Camera 2 immediately tags the nearest available "Unknown" tracker ID with the confirmed USN.
  * **Final Logging:** Periodically checks all currently tracked and identified students and logs their attendance, ensuring each student is logged only **once per class per day**.

-----

## üõ†Ô∏è Technical Stack

| Category | Technologies |
| :--- | :--- |
| **Vision/ML** | DeepFace (ArcFace), YOLOv8, OpenCV, Supervision |
| **Backend** | Python, FastAPI, uvicorn |
| **Frontend/Demo** | Streamlit |
| **Database** | MySQL, `mysql-connector-python` |
| **Utility** | `requests`, `numpy`, `base64`, `pydantic` |

The primary dependencies are listed in the `requirements.txt` and `Attendance_tracking/cam 2/requirements.txt` files.

-----

## ‚öôÔ∏è Setup and Installation



### 1\. Environment Setup

It's important set up the MySQL database connection details first using environment variables in a **`.env`** file.

Create a file named `.env` in the root directory and populate it:

```env
DB_HOST=your_mysql_host
DB_USER=your_mysql_user
DB_PASSWORD=your_mysql_password
DB_NAME=your_database_name
DB_PORT=your_mysql_port
```

### 3\. Install Dependencies

Install the core dependencies:


### 4\. Data Preparation

#### A. Download Student Images

Run `photos.py` to download enrollment images from your database.

```bash
python photos.py
# Images will be saved in the 'enrollment_images/' directory
```

#### B. Generate Face Database

Run `enroll.py` to process the images and create the face embeddings database.
Make sure to change directory based on your computer directory

```bash
# Note: You may need to update the STUDENT_IMAGES_PATH inside enroll.py first.
python Attendance_tracking/enroll.py
# A face_database.json file will be created
```

### 5\. Running the Application

This project requires three main components to run simultaneously:

#### A. Start Camera 1 (Face) Backend (FastAPI)

```bash
python Attendance_tracking/main.py
# Runs on 0.0.0.0:8000
```

#### B. Start Camera 2 (Tracker) Backend (FastAPI & YOLO)

```bash
python Attendance_tracking/cam\ 2/camera_2_tracker.py
# Runs its API on 0.0.0.0:7000 and the video stream on /stream
```

#### C. Start Camera 1 UI (Streamlit)

```bash
streamlit run Attendance_tracking/cam1UI.py
# A browser window will open for the camera interface.
```

Ensure all IP addresses in the configuration files (`cam1UI.py`, `main.py`, `camera_2_tracker.py`) are properly configured so that it can work seamlessly using both the cameras.

Thank You,
From Team Code Mavericks 